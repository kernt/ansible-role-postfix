---
# https://github.com/mrlesmithjr/ansible-postfix/tree/master/templates
# https://github.com/practical-ansible/mail
# https://github.com/Oefenweb/ansible-postfix
# https://wiki.gentoo.org/wiki/Complete_Virtual_Mail_Server/Postfix_to_Database/en
# https://www.df.eu/de/support/df-faq/cloudserver/anleitungen/spam-und-virenschutz-mit-postfix-debian/

- name: Verify base domain is set
  fail:
    msg: >
      Mail domain must be defined set env variable PRACTICAL_MAIL_DOMAIN
      to your desired domain name
  when: postfix_base_domain is not defined

- include_vars: "{{ ansible_os_family }}.yml"
- include_tasks: "{{ ansible_os_family }}.yml"

- name: Ensure postfix is installed.
  package:
    name: postfix
    state: present
  tags: [postfix]

- name: Ensure postfix is started and enabled
  systemd:
    name: postfix
    state: "{{ postfix_service_state }}"
    enabled: "{{ postfix_service_enabled }}"

- name: Include tasks for testmail
  include_tasks: testmail.yml
  when: enable_send_testmail| bool

- name: Include tasks for config-build
  include_tasks: config-build.yml

- name: Include tasks for certificates
  include_tasks: certificates.yml
  when: enable_postfix_certbot| bool

- name: Include tasks for IMAP Server Dovecot
  include_tasks: dovecot.yml
  when: enable_postfix_dovecot| bool

- name: Include tasks for saslauthd
  include_tasks: saslauthd.yml
  when: enable_postfix_saslauthd| bool
